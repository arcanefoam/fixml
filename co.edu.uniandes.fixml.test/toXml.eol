processNode( '', XmlDoc.root );

operation processNode( prefix, node ) : objectModel!XMLNode {

   if ( node.nodeType == 1 or node.nodeType == 2 ) {
   (prefix + node.nodeName).println();


	var xmlNode = new objectModel!XMLNode;
	xmlNode.tag = node.nodeName;

	var i = 0;
	while ( i < node.attributes.length ) {
	
		var attribute = new objectModel!XMLAttribute;
		attribute.name = node.attributes.item( i ).nodeName;
		attribute.value = node.attributes.item( i ).nodeValue; 
		xmlNode.attributes.add( attribute );
	
		("\t" + node.attributes.item( i ).nodeName + "=" + node.attributes.item( i ).nodeValue) .println();
		i = i + 1;
	} 
	
	i = 0;
	while ( i < node.childNodes.length ) {
	
		var child = node.childNodes.item( i );
		if ( child.nodeType == 1 or child.nodeType == 2 ) {
			xmlNode.subnodes.add( processNode( (prefix + node.nodeName+ "_" ), child ) );
		}
		i = i + 1;
  	}
  	return xmlNode;	
  }
  
}

